{"version":3,"sources":["file:///Users/weimao/XiaYu/VScodeProject/CocosCreate/spine/assets/src/Machine.ts"],"names":["_decorator","Component","Node","assetManager","Texture2D","sp","Sprite","FileTools","Html5","ccclass","property","Machine","spineJson","spineAtlas","spineTexture","start","onTest","console","log","spr","self","HtmlFileInput","file","LoadImage","texture","loadJson","getInstance","readLocalFile","data","loadAtlas","addSpine","loadRemoto","base","loadRemote","err","asset","cc","error","image","spriteFrame","spineNode","name","setPosition","skeleton","addComponent","Skeleton","find","addChild","SkeletonData","skeletonJson","atlasText","textures","textureNames","skeletonData","animation","onLoadSpine","destroy","imageUrl","skeUrl","atlasUrl","loader","load","url","type","atlasJson","_uuid","onLoadSpine2","comp","getComponent","ske","atlas","loadAny","ext","assets"],"mappings":"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","sourcesContent":["\n\nimport { _decorator, Component, Node,assetManager,Texture2D,SpriteFrame,ImageAsset,sp } from 'cc';\nimport FileTools from './FileTools';\nimport { Html5 } from './Html5';\n\nimport {Sprite} from 'cc'\n\nconst { ccclass, property } = _decorator;\n\n@ccclass('Machine')\nexport class Machine extends Component {\n\n  @property(Sprite)\n  sp: Sprite = null!;\n\n\n  spineJson :any = null;\n  spineAtlas : any = null;\n  spineTexture: any = null;\n\n\n  start() {\n\n\n    \n  }\n\n\n\n\n\n\n  onTest() :void {\n    console.log('==========点击测试按钮！！');\n\n    let spr = this.sp;\n\n    let self = this;\n    /***/\n    Html5.HtmlFileInput(function( file : any ){\n\n      console.log('===========选择文件成功-data:',file);\n\n      Html5.LoadImage(file,spr, function( texture: Texture2D ){\n\n        self.spineTexture = texture;\n\n\n      });\n\n\n    });\n  }\n\n\n  loadJson() {\n    let self = this;\n    Html5.HtmlFileInput(function( file : any ){\n\n      FileTools.getInstance().readLocalFile(file,1,function( data : any ){\n        console.log('===========读取Json成功-data:',data);\n        self.spineJson = data\n      });\n\n    });\n  }\n\n  loadAtlas() {\n    let self = this;\n    Html5.HtmlFileInput(function( file : any ){\n\n      FileTools.getInstance().readLocalFile(file,1,function( data : any ){\n        console.log('===========读取Atlas成功-data:',data);\n        \n        self.spineAtlas = data\n\n\n        self.addSpine();\n\n      });\n\n    });\n  }\n\n  loadRemoto () {\n    //const base = url;\n    //assetManager.loadRemote(base, { ext: '.png' }, (err: Error, texture: Texture2D) => {\n\n    let sp = this.sp;\n    let base = 'http://127.0.0.1/image/Socre_CandyMonsters_Scatter.png';\n    assetManager.loadRemote(base, (err, asset: ImageAsset) => {\n      if (err) return cc.error(err);\n      console.log('asset:',asset)\n\n      let texture = new Texture2D();\n      texture.image = asset;\n\n      // sp.spriteFrame = new SpriteFrame();\n      // sp.spriteFrame.setTexture(texture)\n      // sp.spriteFrame._texture = texture\n      // sp.spriteFrame._texture = texture.getHtmlElementObj()\n      sp.spriteFrame.texture = texture\n    })\n  }\n\n\n\n  private addSpine () {\n    let spineNode = new Node();\n    spineNode.name = 'newSpine';\n    spineNode.setPosition(0,0);\n    var skeleton = spineNode.addComponent(sp.Skeleton);\n\n    // skeleton.parent = this.node;\n    cc.find(\"Canvas\").addChild(spineNode);\n\n    let asset = new sp.SkeletonData();\n    asset.skeletonJson = this.spineJson;\n    asset.atlasText = this.spineAtlas;\n    asset.textures = [this.spineTexture];\n    asset.textureNames = ['xxx1122.png'];\n\n\n    skeleton.skeletonData = asset;\n    skeleton.animation = 'beiji';\n    //skeleton._updateSkeletonData();\n\n\n  }\n\n\n  onLoadSpine() {\n    if (cc.find('Canvas/newSpine')) {\n        cc.find('Canvas/newSpine').destroy();\n    }\n    else {\n        var spineNode = new cc.Node();\n        spineNode.name = 'newSpine';\n        spineNode.setPosition(49, -237);\n        var skeleton = spineNode.addComponent(sp.Skeleton);\n        cc.find(\"Canvas\").addChild(spineNode);\n        //TODO : 此处为你的远程资源路径\n        // var imageUrl = \"http://127.0.0.1:7456/assets/resources/spineRaptor/raptor.png\";\n        // var skeUrl = \"http://127.0.0.1:7456/assets/resources/spineRaptor/raptor.json\";\n        // var atlasUrl = \"http://127.0.0.1:7456/assets/resources/spineRaptor/raptor.atlas\";\n\n\n        var imageUrl = \"http://127.0.0.1/raptor.png\";\n        var skeUrl = \"http://127.0.0.1/raptor.json\";\n        var atlasUrl = \"http://127.0.0.1/raptor.atlas\";\n    \n        cc.loader.load(imageUrl, (error, texture) => {\n            cc.loader.load({ url: atlasUrl, type: 'txt' }, (error, atlasJson) => {\n                cc.loader.load({ url: skeUrl, type: 'txt' }, (error, spineJson) => {\n\n                    var asset = new sp.SkeletonData();\n                    asset._uuid = skeUrl;\n                    asset.skeletonJson = spineJson;\n                    asset.atlasText = atlasJson;\n                    asset.textures = [texture];\n                    asset.textureNames = ['raptor.png'];\n\n                    skeleton.skeletonData = asset;\n                    // skeleton.animation = 'walk';\n                    // skeleton._updateSkeletonData();\n                });\n            });\n        });\n    }\n  }\n\n\n  onLoadSpine2() {\n    let comp = this.getComponent('sp.Skeleton') as sp.Skeleton;\n\n    var spineNode = new cc.Node();\n    spineNode.name = 'newSpine';\n    spineNode.setPosition(49, -237);\n    var skeleton = spineNode.addComponent(sp.Skeleton);\n    cc.find(\"Canvas\").addChild(spineNode);\n\n    let image = \"http://127.0.0.1/raptor.png\";\n    let ske = \"http://127.0.0.1/raptor.json\";\n    let atlas = \"http://127.0.0.1/raptor.atlas\";\n    assetManager.loadAny([{ url: atlas, ext: '.txt' }, { url: ske, ext: '.txt' }], (error, assets) => {\n        assetManager.loadRemote(image, (error, texture: Texture2D) => {\n            let asset = new sp.SkeletonData();\n            asset.skeletonJson = assets[1];\n            asset.atlasText = assets[0];\n            asset.textures = [texture];\n            asset.textureNames = ['1.png'];\n            \n            skeleton.skeletonData = asset;\n        });\n    });\n  }\n\n}\n\n\n\n"]}