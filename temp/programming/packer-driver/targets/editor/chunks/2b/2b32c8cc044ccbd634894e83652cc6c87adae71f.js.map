{"version":3,"sources":["file:///Users/mac/WorkSpace/maowei/spine/assets/src/Menu/FileOper.ts"],"names":["_decorator","Component","sp","Html5","SpineData","ccclass","property","FileOper","_bComplete","_bBinary","_bJson","_jsonData","_atlasData","_skeletData","_textureData","_pngName","rest","checkComplect","console","log","addSkeletonData","asset","SkeletonData","skeletonJson","atlasText","textures","textureNames","_nativeAsset","_uuid","_nativeUrl","data","bJson","bBinary","sName","skeletonData","skins","animations","onPng","self","readTexture2d","name","texture","onJsonData","readLocalFile","onAtlasData","onSkelData"],"mappings":"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","sourcesContent":["import { Html5 } from '../Tool/Html5';\nimport FileTools from '../Tool/FileTools';\n\nimport { SpineData } from '../Data/SpineData';\n\nimport { _decorator, Component, Node, Texture2D,sp } from 'cc';\nconst { ccclass, property } = _decorator;\n\n\n\n@ccclass('FileOper')\nexport class FileOper extends Component {\n\n  private _bComplete : boolean = false;\n  private _bBinary :boolean = false;\n  private _bJson:boolean = false;\n\n  private _jsonData : any = null;\n  private _atlasData: string = null;\n  private _skeletData: any = null;\n  private _textureData : Texture2D = null;\n\n  private _pngName : string = 'defa'\n\n\n  private rest(): void {\n    this._bComplete = false;\n    this._bBinary = false;\n    this._bJson = false;\n    this._jsonData  = null;\n    this._atlasData = null;\n    this._skeletData = null;\n    this._textureData = null\n    this._pngName  = 'defa'\n  }\n\n\n  private checkComplect() :void {\n\n    if(this._atlasData && this._textureData){\n\n      if(this._jsonData || this._skeletData) {\n\n        console.log('[FileOper]:数据读取完成');\n\n        this._bComplete = true;\n\n        this._bJson = this._jsonData || false;\n        this._bBinary = this._skeletData || false;\n      }\n    }\n\n    if (this._bComplete) {\n\n      this.addSkeletonData();\n\n    }\n\n  }\n\n\n  private addSkeletonData (): void {\n\n    let asset = new sp.SkeletonData();\n    \n    if (this._bJson){\n      asset.skeletonJson = this._jsonData;\n      asset.atlasText = this._atlasData;\n      asset.textures = [this._textureData];\n      asset.textureNames = [this._pngName];\n    }\n    else\n    {\n      asset._nativeAsset = this._skeletData;\n      asset.atlasText = this._atlasData;\n      asset.textures = [this._textureData];\n      asset.textureNames = [this._pngName];\n      asset._uuid = this._pngName + 'good';\n\n      // 传入一个二进制路径用作 initSkeleton 时的 filePath 参数使用\n      asset._nativeUrl = 'sdsd';\n    }\n\n    let data = new SpineData();\n    data.bJson = this._bJson;\n    data.bBinary = this._bBinary;\n    data.sName = this._pngName;\n    data._jsonData = this._jsonData;\n    data._atlasData = this._atlasData;\n    data._skeletData = this._skeletData;\n    data._textureData = this._textureData;\n    data.skeletonData = asset;\n\n    data.skins = [];\n    data.animations = [];\n\n\n    \n    this.rest();\n  }\n\n\n\n\n  onPng () {\n    let self = this;\n    Html5.readTexture2d(function(name: string, texture : Texture2D ){\n      console.log('===========选择文件成功-data:',name);\n      self._textureData = texture;\n      self._pngName = name;\n\n      self.checkComplect();\n    });\n  }\n\n  onJsonData () {\n\n    let self = this;\n    Html5.readLocalFile(function( data : any ){\n      console.log('===========读取Json成功-data:',data);\n      self._jsonData = data\n      self.checkComplect();\n    });\n\n  }\n\n  onAtlasData() {\n    let self = this;\n    Html5.readLocalFile(function( data : any ){\n      console.log('===========读取Atlas成功-data:',data);\n      self._atlasData = data\n      self.checkComplect();\n    });\n  }\n\n  onSkelData () {\n\n    this.checkComplect();\n  }\n\n  \n\n\n}\n\n"]}