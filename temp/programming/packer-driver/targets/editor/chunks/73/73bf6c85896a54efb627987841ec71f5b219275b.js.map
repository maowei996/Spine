{"version":3,"sources":["file:///Users/weimao/XiaYu/VScodeProject/CocosCreate/Spine/assets/src/Tool/Html5.ts"],"names":["Html5","Texture2D","ImageAsset","sys","FileTools","mime","createObjectURL","blob","window","URL","undefined","SelectFile","file","console","log","fileType","type","name","match","url","HtmlFileInput","_fileType","_cb","inputel","document","getElementById","createElement","id","setAttribute","style","opacity","position","body","appendChild","onchange","event","files","length","filedata","onclick","remove","click","setClipboardData","str","alert","platform","queryCommandSupported","textarea","value","select","setSelectionRange","result","execCommand","LoadImage","sp","_onComplete","div","backgroundColor","innerHTML","image","src","onload","width","height","strurl","currentSrc","imas","texture","display","visibility","readLocalFile","readType","cbComplect","getInstance","data","readTexture2d"],"mappings":"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","sourcesContent":["import { Texture2D,ImageAsset,SpriteFrame,sys } from 'cc';\nimport FileTools from './FileTools';\n\nlet mime = {'png': 'image/png', 'jpg': 'image/jpeg', 'jpeg': 'image/jpeg', 'bmp': 'image/bmp'};\n\n\n\n\nlet createObjectURL = function(blob : Blob){\n  if(window.URL != undefined)\n    return window['URL']['createObjectURL'](blob);\n  else\n    return window['webkitURL']['createObjectURL'](blob);\n}\n\n\nlet SelectFile = function ( file : any) :string {\n  if(!file){\n    console.log('SelectFile error!');\n    return;\n  }\n\n  let fileType = file.type;\n  if(!fileType) {\n    fileType = mime[file.name.match(/\\.([^\\.]+)$/i)[1]];\n  }\n\n  var url  = createObjectURL(file);\n\n  return url;\n}\n\n\n\n///html 接口\n\n\nexport class Html5 {\n\n\n  public static HtmlFileInput(  _fileType:string, _cb : Function,) : void {\n\n    let inputel : HTMLInputElement = <HTMLInputElement>document.getElementById('file_input');\n    if(!inputel) {\n      inputel = document.createElement('input');\n      inputel.id = 'file_input';\n      inputel.setAttribute('id', 'file');\n      inputel.setAttribute('type', 'file');\n      inputel.setAttribute('class', 'fileToUpload');\n      inputel.style.opacity = '0';\n      inputel.style.position = 'absolute';\n      inputel.setAttribute('left', '-999px');\n      document.body.appendChild(inputel);\n    }\n\n    inputel.setAttribute('accept', _fileType || '*');\n    inputel.onchange = function(event: any) {\n\n      let files = inputel.files;\n      if(files && files.length > 0) {\n\n        let filedata = files[0];\n        _cb && _cb(filedata);\n      }\n      // inputel.remove();\n    }\n\n    inputel.onclick = function () {\n      inputel.remove();\n    }\n\n    // inputel.oncancel = function () {\n    //   inputel.remove();\n    // }\n\n    // inputel.onclose = function () {\n    //   inputel.remove();\n    // }\n\n    // inputel.ondblclick = function () {\n    //   inputel.remove();\n    // }\n\n    // inputel.onended = function () {\n    //   inputel.remove();\n    // }\n\n    // inputel.onemptied = function () {\n    //   inputel.remove();\n    // }\n\n    inputel.click();\n  }\n\n  /**\n   * 设置系统剪贴板的内容\n   * @param str \n   */\n  public static setClipboardData(str: string): void {\n    if (!str || str == '') return window.alert('文本无效');\n    if (sys.platform == 'MOBILE_BROWSER' || sys.platform == 'DESKTOP_BROWSER'){\n      if (!document.queryCommandSupported('copy')) {\n        window.alert('浏览器不支持');\n        return;\n      }\n      let textarea = document.createElement(\"textarea\")\n      textarea.value = str\n      document.body.appendChild(textarea)\n      textarea.select()\n      textarea.setSelectionRange(0, str.length)\n      let result = document.execCommand(\"copy\")\n      if(result){\n        //window.alert('已成功复制到剪贴板！');\n      }else{\n        //window.alert('复制失败！');\n      }    \n      textarea.remove();\n      return;\n    }\n    window.alert('暂不支持该平台复制');\n  }\n\n\n  //\n  public static LoadImage(  file: any, sp:any, _onComplete:Function) : void {\n    let url = SelectFile(file);\n    let div : HTMLElement = document.getElementById(\"divCreator\");\n    if(!div){\n      div = document.createElement(\"div\");\n      document.body.appendChild(div);\n      div.style.position=\"absolute\";\n      div.id = \"divCreator\";\n      //div.style.width = 100;\n      //div.style.height = 100;\n      div.style.backgroundColor=\"#ffffcc\";\n    }\n\n    div.innerHTML = '<img id=imghead>'\n    let image : any = document.getElementById('imghead');\n\n    image.src = url;\n\n    image.onload = function () {\n      console.log('=========LoadImage.image.onload');\n\n      console.log('width:',this.width);\n      console.log('width:',this.height);\n\n      //console.log(image);\n\n      let strurl = image.currentSrc\n\n\n      //let img = new Image();\n      //img.src = strurl\n\n      let imas = new ImageAsset(image);\n      //imas._nativeAsset = image;\n\n\n      let texture = new Texture2D();\n      texture.image = imas;\n      console.log(texture);\n      // texture.initWithElement(image);\n      // texture.handleLoadedTexture();\n\n      // sp.spriteFrame = new SpriteFrame();\n      // sp.spriteFrame.setTexture(texture)\n      // sp.spriteFrame._texture = texture\n      // sp.spriteFrame._texture = texture.getHtmlElementObj()\n      // sp.spriteFrame.texture = texture\n\n      // let frame = new SpriteFrame();\n      // frame.texture = texture;\n      // sp.spriteFrame = frame;\n\n      // sp.width = this.width;\n      // sp.height = this.height;\n      \n      _onComplete && _onComplete(strurl,texture);\n\n    }\n\n\n    div.style.display='none';\n    div.style.visibility = \"hidden\";\n  }\n\n\n\n  static readLocalFile (fileType:string, readType:number = 1,cbComplect:Function ):void {\n\n    Html5.HtmlFileInput(fileType,function( file : any ){\n      FileTools.getInstance().readLocalFile(file,readType,function( data : any ){\n\n        let url = SelectFile(file);\n\n        cbComplect && cbComplect(file.name, data,url);\n\n      });\n    });\n  }\n\n\n  static readTexture2d (fileType:string, cbComplect:Function ):void {\n\n    Html5.HtmlFileInput(fileType,function( file : any ){\n      Html5.LoadImage(file,null, function( url: string, texture: Texture2D ){\n        cbComplect && cbComplect(file.name,url, texture);\n      });\n    });\n  }\n\n}"]}